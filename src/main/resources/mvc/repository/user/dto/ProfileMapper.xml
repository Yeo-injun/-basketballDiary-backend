<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.threeNerds.basketballDiary.mvc.user.repository.dto.ProfileRepository">

    <select id="findMyProfile" resultType="com.threeNerds.basketballDiary.mvc.user.dto.MyProfileDTO">
        /* ProfileRepository.findMyProfile */
        SELECT
               USER_SEQ
             , USER_ID
             , NAME AS USER_NAME
             , EMAIL
             , BIRTH_YMD
             , GENDER
             , HEIGHT
             , WEIGHT
             , POSITION_CODE
             , SIDO_CODE
             , SIGUNGU_CODE
             , ROADADDRESS AS ROAD_ADDRESS
             , USER_IMAGE_PATH
          FROM USER
         WHERE 1=1
           AND USER_SEQ = #{userSeq}
    </select>

    <select id="findAllUsersExcludingTeamMemberByUserNameOrEmail" resultType="com.threeNerds.basketballDiary.mvc.user.dto.UserDTO">
        /* UserRepository.findAllUsersExcludingTeamMemberByUserNameOrEmail */
        /* TODO 쿼리속성 변경 필요 */
        SELECT USER_SEQ
             , USER_ID
             , NAME AS USERNAME
             , EMAIL
             , USER_REG_YN
             , GENDER
             , HEIGHT
             , WEIGHT
             , SIDO_CODE
             , SIGUNGU_CODE
             , POSITION_CODE
          FROM USER
         WHERE 1=1
           AND USER_SEQ NOT IN (
                                SELECT USER_SEQ
                                  FROM TEAM_MEMBER
                                 WHERE 1=1
                                   AND TEAM_SEQ = #{teamSeq}
                               )
        <choose>
            <when test='userName != null and !"".equals( userName )'>
           AND NAME LIKE '%${userName}%'
            </when>
            <when test='email != null and !"".equals( email )'>
           AND EMAIL LIKE '%${email}%'
            </when>
        </choose>
    </select>


</mapper>